---
import Layout from "src/layouts/Layout.astro";
import Sidebar from "../components/ui/Sidebar.astro";
import "../styles/global.css";
---

<Layout>
  <Sidebar />
  <main class="ml-20 p-10 w-full">
    <h1 class="text-3xl font-black mb-8">Activity Log</h1>

    <div class="bg-gray-900 rounded-xl border border-gray-800 overflow-hidden">
      <table class="w-full text-left">
        <thead class="bg-gray-800 text-gray-400 uppercase text-xs">
          <tr>
            <th class="px-6 py-4 text-accent">Activity</th>
            <th class="px-6 py-4">Duration</th>
            <th class="px-6 py-4">Time</th>
          </tr>
        </thead>
        <tbody id="log-table-body"></tbody>
      </table>
    </div>
  </main>

  <script>
    import { logStore } from "../lib/logStore";

    // 1. MATCH THE ID: Changed from activity-log-container to log-table-body
    const tableBody = document.getElementById("log-table-body");

    logStore.subscribe((logs) => {
      if (!tableBody) return;

      const allLogs = [...logs].reverse();

      if (allLogs.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="3" class="px-6 py-10 text-center text-gray-500 italic">No logs found yet.</td></tr>`;
        return;
      }

      // 2. GENERATE TABLE ROWS: Map to <tr> instead of <div>
      tableBody.innerHTML = allLogs
        .map((log) => {
          const displayName =
            log.activity ?? log.activityName ?? "Focus Session";
          return `
            <tr class="border-t border-gray-800 hover:bg-gray-800/50 transition-colors">
              <td class="px-6 py-4 font-bold text-gray-100">${displayName}</td>
              <td class="px-6 py-4 font-mono text-accent text-sm">${log.duration}</td>
              <td class="px-6 py-4 text-xs text-gray-500">${log.timestamp}</td>
            </tr>
          `;
        })
        .join("");
    });
  </script>
</Layout>
