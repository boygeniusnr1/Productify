---
import Sidebar from "@components/ui/Sidebar.astro";
import Layout from "src/layouts/Layout.astro";
import "../styles/global.css";
---

<Layout>
  <Sidebar />
  <main class="ml-20 p-10 w-full max-w-4xl">
    <h1 class="text-3xl font-black mb-8">Manage Exercises</h1>

    <div
      class="bg-gray-900 p-6 rounded-2xl border border-gray-800 mb-10 shadow-xl"
    >
      <h2 class="text-gray-400 uppercase text-xs tracking-widest mb-4">
        Add New Goal
      </h2>
      <div class="flex gap-4">
        <input
          id="add-name"
          type="text"
          placeholder="Exercise Name"
          class="flex-1 bg-gray-850 border border-gray-700 rounded-xl px-4 py-2 outline-none focus:border-accent"
        />
        <input
          id="add-goal"
          type="number"
          placeholder="Goal"
          class="w-24 bg-gray-850 border border-gray-700 rounded-xl px-4 py-2 outline-none focus:border-accent"
        />
        <button
          id="add-confirm-btn"
          class="bg-accent text-black px-6 py-2 rounded-xl font-bold hover:bg-accent/80 transition-colors"
          >Create</button
        >
      </div>
    </div>

    <div id="manage-list" class="space-y-4"></div>
  </main>

  <script>
    import { exerciseList, addExercise } from "../lib/exerciseStore";

    const list = document.getElementById("manage-list");
    const addBtn = document.getElementById("add-confirm-btn");

    // 1. Render the List with Delete functionality
    exerciseList.subscribe((exercises) => {
      if (!list) return;
      list.innerHTML = exercises
        .map(
          (ex) => `
        <div class="flex items-center justify-between bg-gray-900 p-5 rounded-2xl border border-gray-800">
          <div>
            <h3 class="font-bold text-lg text-white">${ex.name}</h3>
            <p class="text-sm text-gray-500">Target: ${ex.goal} reps</p>
          </div>
          <button data-id="${ex.id}" class="delete-btn p-2 text-gray-600 hover:text-red-500 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
          </button>
        </div>
      `,
        )
        .join("");

      // Handle Deletion
      list.querySelectorAll(".delete-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const id = (btn as HTMLElement).dataset.id;
          const currentList = exerciseList.get();
          exerciseList.set(currentList.filter((e) => e.id !== id));
        });
      });
    });

    // 2. Handle Adding
    addBtn?.addEventListener("click", () => {
      const nameInput = document.getElementById("add-name") as HTMLInputElement;
      const goalInput = document.getElementById("add-goal") as HTMLInputElement;

      if (nameInput.value && goalInput.value) {
        addExercise(nameInput.value, parseInt(goalInput.value));
        nameInput.value = "";
        goalInput.value = "";
      }
    });
  </script>
</Layout>
